<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Donate to Baby's College Fund</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="college-fund-calc.js"></script>
  </head>
  <body class="bg-gray-100 flex justify-center items-center min-h-screen">
    <div class="bg-white p-8 rounded-lg shadow-md w-96">
      <h1 class="text-4xl font-bold mb-6">Donate to Baby's College Fund</h1>

      <div class="flex items-center space-x-2 bg-gray-100 p-2 rounded mb-4">
        <span class="text-2xl font-bold">$</span>
        <input
          type="number"
          id="amount"
          class="w-full bg-transparent text-2xl font-bold focus:outline-none"
          value="532"
        />
      </div>

      <div
        id="futureValue"
        class="p-3 bg-blue-100 rounded text-blue-800 font-semibold text-center mb-4"
      >
        In 18 years this will be $2,125.88
      </div>

      <div id="purposeOptions" class="grid grid-cols-2 gap-2 mb-4">
        <!-- Purpose options will be dynamically inserted here -->
      </div>

      <button
        id="donateButton"
        class="w-full bg-green-500 text-white font-bold py-2 px-4 rounded hover:bg-green-600 transition duration-300"
      >
        Donate via Venmo
      </button>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const purposeOptionsContainer =
          document.getElementById("purposeOptions");
        const amountInput = document.getElementById("amount");
        const futureValueDiv = document.getElementById("futureValue");
        const donateButton = document.getElementById("donateButton");
        let selectedPurpose = "";

        // Fetch purposes from the server
        fetch("/purposes")
          .then((response) => response.json())
          .then((data) => {
            data.purposes.forEach((purpose) => {
              const button = document.createElement("button");
              button.textContent = purpose;
              button.className =
                "p-2 bg-gray-200 rounded text-sm hover:bg-blue-500 hover:text-white transition duration-300";
              button.onclick = () => selectPurpose(purpose, button);
              purposeOptionsContainer.appendChild(button);
            });
          });

        function selectPurpose(purpose, button) {
          selectedPurpose = purpose;
          document.querySelectorAll("#purposeOptions button").forEach((btn) => {
            btn.classList.remove("bg-blue-500", "text-white");
            btn.classList.add("bg-gray-200");
          });
          button.classList.remove("bg-gray-200");
          button.classList.add("bg-blue-500", "text-white");
        }

        amountInput.addEventListener("input", updateFutureValue);

        function updateFutureValue() {
          const principal = parseFloat(amountInput.value) || 0;
          const years = 18;
          const rate = 0.08; // 8% annual return
          const futureValue = CollegeFundCalc.calculateFutureValue(
            principal,
            years,
            rate
          );
          futureValueDiv.textContent = `In ${years} years this will be ${CollegeFundCalc.formatCurrency(
            futureValue
          )}`;
        }

        donateButton.addEventListener("click", function () {
          const amount = amountInput.value;
          if (!amount || !selectedPurpose) {
            alert("Please enter an amount and select a purpose.");
            return;
          }

          fetch("/submit", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ amount, purpose: selectedPurpose }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.paymentLink) {
                window.location.href = data.paymentLink;
              } else {
                alert("Error generating payment link. Please try again.");
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              alert("An error occurred. Please try again.");
            });
        });

        updateFutureValue();
      });
    </script>
  </body>
</html>
